<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="three.min.js"></script>
<script>
$(function() {
    var speed=.6;
    var xvel=0;
    var yvel=0;
    var zvel=0;
    var velC=.9;
    $(document).keydown(function(e) {
        var code = (e.keyCode ? e.keyCode : e.which);
        if (code===37) {
            console.log("left!");
            //xpos-=speed;
            xvel-=speed;

        }
        else if (code===39) {
            console.log("right!");
            //xpos+=speed;
            xvel+=speed;
        }
        else if (code===38) { //up
            zvel-=speed;
        }
        else if (code===40) { //down
            zvel+=speed;
        }
        else {
            return;
        }
        /*socket.emit('movement', {
            xpos:xpos
        });*/
    });
    var camera, scene, renderer;
    var geometry, material, cube;
    var width=window.innerWidth;
    var height=window.innerHeight;

    init();
    render();

    function init() {
        //z:forward(-)/backward(+), x:left/right, y:up/down
        //CubeGeometry(width, height, depth, widthSegments, heightSegments, depthSegments)
        camera = new THREE.PerspectiveCamera( 75, width / height, .1, 1000 );
        camera.position.z = 20;

        scene = new THREE.Scene();

        geometry = new THREE.CubeGeometry( 1, 1, 1 );
        //material = new THREE.MeshBasicMaterial( { color: 0xff0000} );
        texture = THREE.ImageUtils.loadTexture('sonic_sonicRunning.gif');
        material = new THREE.MeshBasicMaterial({map: texture});

        cube = new THREE.Mesh( geometry, material );
        cube.position.x=2;
        cube.position.y=0;
        cube.position.z=0;
        scene.add( cube );

        /*for (var i=-10;i<=10;i++)
        {
            for (var j=-10;j<=10;j++)
            {
                for (var k=-1; k<=1; k++)
                {
                    var geometry_ = new THREE.CubeGeometry( 1, 1, 1 );
                    var material_ = new THREE.MeshBasicMaterial( { color: 0x0000ff, wireframe:true} );
                    //var texture_ = THREE.ImageUtils.loadTexture('sonic_sonicRunning.gif');
                    //var material_ = new THREE.MeshBasicMaterial({map: texture_});

                    var cube_ = new THREE.Mesh( geometry_, material_ );
                    cube_.position.x=i;
                    cube_.position.y=j;
                    cube_.position.z=k;
                    scene.add( cube_ );
                }
            }
        }*/
        var geometry_,material_,cube_;
        //floor:
        geometry_ = new THREE.CubeGeometry( 100, 1, 100 );
        material_ = new THREE.MeshBasicMaterial( { color: 0x964B00, wireframe:false} );

        cube_ = new THREE.Mesh( geometry_, material_ );
        cube_.position.x=0;
        cube_.position.y=-10;
        cube_.position.z=0;
        scene.add( cube_ );

        //walls:
        geometry_ = new THREE.CubeGeometry( 1, 50, 100 );
        material_ = new THREE.MeshBasicMaterial( { color: 0x007700, wireframe:false} );

        cube_ = new THREE.Mesh( geometry_, material_ );
        cube_.position.x=-50;
        cube_.position.y=15;
        cube_.position.z=0;
        scene.add( cube_ );

        //randomness:
        geometry_ = new THREE.CubeGeometry( .4, .4, .4 );
        material_ = new THREE.MeshBasicMaterial( { color: 0x770000, wireframe:false} );

        for (var i=-100;i<=100;i++) {
            for (var j=-100;j<=100;j++) {
                if (Math.random()<.01) {
                    cube_ = new THREE.Mesh( geometry_, material_ );
                    cube_.position.x=i;
                    cube_.position.y=Math.floor(Math.random()*11);
                    cube_.position.z=j;
                    scene.add( cube_ );
                }
            }
        }

        renderer = new THREE.WebGLRenderer();
        //THREE.WebGLRenderer() THREE.CanvasRenderer()
        renderer.setSize( width, height );
        //renderer.setSize(720,540);
        renderer.setClearColorHex( 0xfffeef, 1 );

        document.body.appendChild( renderer.domElement );

    }
    function render() {

        // requestAnimationFrame stops when going to a diff. tab
        requestAnimationFrame( render );

        cube.rotation.x += 0.01;
        cube.rotation.y += 0.01;
        cube.rotation.z += 0.01;
        camera.position.x+=xvel;
        camera.position.y+=yvel;
        camera.position.z+=zvel;
        xvel*=velC;
        yvel*=velC;
        zvel*=velC;
        renderer.render( scene, camera );

    }

});
</script>
<style>
canvas {
    width:100%;
    height:100%;
}
body {
    margin:0;
    padding:0;
}
</style>